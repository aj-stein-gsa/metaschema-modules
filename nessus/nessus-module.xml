<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="https://raw.githubusercontent.com/usnistgov/metaschema/develop/schema/xml/metaschema.xsd" type="application/xml" schematypens="http://www.w3.org/2001/XMLSchema"?>
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0">
    <schema-name>Tenable Nessus Metaschema Module</schema-name>
    <schema-version>0.1.0</schema-version>
    <!-- 
        Developer docs and forum posts mention the namespace:
        https://developer.tenable.com/docs/export-file-formats
        https://community.tenable.com/s/question/0D5f200004rM1i0CAC/nessus-xml-xsd
    -->
    <short-name>nessus</short-name>
    <namespace>http://www.nessus.org/cm</namespace>
    <json-base-uri>http://www.nessus.org/cm</json-base-uri>
    <define-assembly name="NessusClientData_v2">
        <!-- Documents and community posts evidence NessusClientData and NessusClientData_v2, we use the latter for now. -->
        <root-name>NessusClientData_v2</root-name>
        <model>
            <assembly ref="Policy" min-occurs="0" max-occurs="1">
                <group-as name="Policies" in-xml="GROUPED"/>
            </assembly>
            <assembly ref="Report" min-occurs="0" max-occurs="1"/>
            <assembly ref="PluginSelection" min-occurs="0" max-occurs="1"/>
        </model>
    </define-assembly>
    <define-assembly name="Policy">
        <model>
            <define-field name="PolicyName" as-type="string"/>
            <define-field name="PolicyComments" as-type="string"/>
            <assembly ref="Preferences"/>
        </model>
    </define-assembly>
    <define-assembly name="Report">
        <define-flag name="name" as-type="string"/>
        <model>
            <define-assembly name="ReportHost">
                <define-flag name="name" as-type="string"/>
                <model>
                    <assembly ref="HostProperties"/>
                    <assembly ref="ReportItem"/>
                </model>
            </define-assembly>
        </model>
    </define-assembly>
    <define-assembly name="Preferences">
        <model>
            <assembly ref="ServerPreferences"/>
            <assembly ref="PluginsPreferences" min-occurs="0" max-occurs="1"/>
        </model>
    </define-assembly>
    <define-assembly name="PluginSelection">
        <model>
            <assembly ref="FamilySelection"/>
            <assembly ref="IndividualPluginSelection"/>
        </model>
    </define-assembly>
    <define-assembly name="FamilySelection">
        <model>
            <define-assembly name="FamilyItem">
                <model>
                    <define-field name="FamilyName" as-type="string"/>
                    <define-field name="Status" as-type="string"/>
                </model>
            </define-assembly>
        </model>
    </define-assembly>
    <define-assembly name="IndividualPluginSelection">
        <model>
            <define-assembly name="PluginItem">
                <model>
                    <define-field name="PluginId" as-type="string"/>
                    <define-field name="PluginName" as-type="string"/>
                    <define-field name="Family" as-type="string"/>
                    <define-field name="Status" as-type="string"/>
                </model>
            </define-assembly>
        </model>
    </define-assembly>
    <define-assembly name="PluginsPreferences">
        <model>
            <define-assembly name="item">
                <model>
                    <define-field name="pluginName" as-type="string"/>
                    <define-field name="pluginId" as-type="string"/>
                    <define-field name="fullName" as-type="string"/>
                    <define-field name="preferenceName" as-type="string"/>
                    <define-field name="preferenceType" as-type="string"/>
                    <define-field name="preferenceValues" as-type="string"/>
                    <define-field name="selectedValue" as-type="string"/>
                </model>
            </define-assembly>
        </model>
    </define-assembly>    
    <define-assembly name="ServerPreferences">
        <model>
            <define-field name="name" as-type="string"/>
            <define-field name="value" as-type="string"/>
        </model>
    </define-assembly>
    <define-assembly name="HostProperties">
        <model>
            <define-field name="tag">
                <define-flag name="name" as-type="string"/>
            </define-field>
        </model>
    </define-assembly>
    <define-assembly name="ReportItem">
        <define-flag name="port" required="no" as-type="string"/>
        <define-flag name="svc_name" required="no" as-type="string"/>
        <define-flag name="protocol" required="no" as-type="string"/>
        <define-flag name="severity" required="no" as-type="string"/>
        <define-flag name="pluginID" required="no" as-type="string"/>
        <define-flag name="pluginName" required="no" as-type="string"/>
        <define-flag name="pluginFamily" required="no" as-type="string"/>
        <model>
            <define-field name="exploitability_ease" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="vuln_publication_date" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="cvss_temporal_vector" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="solution" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="cvss_temporal_score" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="risk_factor" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="description" min-occurs="0" max-occurs="1" as-type="string"/>
            <!-- TODO: Unclear if example data conforms to more specific datatype than implemented below, investigate. -->
            <define-field name="plugin_publication_date" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="cvss_vector" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="synopsis" min-occurs="0" max-occurs="1" as-type="string"/>
            <!-- TODO: Unclear if example data conforms to more specific datatype than implemented below, investigate. -->
            <define-field name="patch_publication_date" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="see_also" min-occurs="0" max-occurs="unbounded" as-type="string">
                <group-as name="see_also" in-json="ARRAY"/>
            </define-field>
            <define-field name="exploit_available" min-occurs="0" max-occurs="1" as-type="boolean"/>
            <!-- TODO: Unclear if example data conforms to more specific datatype than implemented below, investigate. -->
            <define-field name="plugin_modification_date" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="fname" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="bid" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="cvss_base_score" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="xref" min-occurs="0" max-occurs="unbounded" as-type="string">
                <group-as name="see_also" in-json="ARRAY"/>
            </define-field>        
            <define-field name="plugin_output" min-occurs="0" max-occurs="1" as-type="string"/>
            <define-field name="plugin_version" min-occurs="0" max-occurs="1" as-type="string"/>
        </model>
    </define-assembly>
</METASCHEMA>
